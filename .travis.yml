language: php

# Add php version so composer doesn't complain
php:
  - 7.1

services:
  - docker

env:
  - DRUPAL_ROOT=/var/www/html

before_script:
  - docker-compose up -d
  - sleep 300

script:
  - docker-compose exec app bash -c 'cd /var/www/html/sites/all/libraries; git clone https://github.com/galaxyproject/blend4php.git'
  - docker-compose exec -u apache app drush pm-enable -y tripal_galaxy
  - docker-compose exec -u apache app bash -c "cd /modules/tripal_galaxy && composer install && DRUPAL_ROOT=/var/www/html ./vendor/bin/phpunit"
